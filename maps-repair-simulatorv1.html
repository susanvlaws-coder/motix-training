<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAPS: Manufacturing And Parts System</title>
    <style>
        :root {
            /* BRANDING: "Compass" Palette */
            --bg-dark: #121212;       /* Deepest Slate */
            --panel-bg: #262626;      /* Dashboard Grey */
            --border: #404040;        /* Structural Grey */
            --text-main: #F1F1F1;     /* Cloud White */
            --text-muted: #A3A3A3;    /* Metal Grey */
            
            --accent: #F2C43D;        /* "Compass Yellow" */
            --text-on-accent: #121212;
            
            --success: #8AC977;       /* Nature Green */
            --danger: #E06C6C;        /* Alert Red */
            --warning: #F2C43D;       /* Same as accent for consistency */
        }

        body {
            font-family: 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* The Main Dashboard Container */
        #maps-dashboard {
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            background-color: var(--panel-bg);
            border: 1px solid var(--border);
            border-radius: 12px; /* Softer corners like automotive UI */
            display: grid;
            grid-template-columns: 260px 1fr;
            grid-template-rows: 70px 1fr 50px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }

        /* Header */
        header {
            grid-column: 1 / -1;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 30px;
            background: rgba(255,255,255,0.02);
            justify-content: space-between;
        }

        .logo { 
            font-weight: 800; 
            letter-spacing: 2px; 
            color: var(--text-main); 
            font-size: 1.2rem;
        }
        .logo span { color: var(--accent); } /* The "Yellow" accent */
        
        .status-badge { 
            background: rgba(138, 201, 119, 0.15); 
            color: var(--success); 
            border: 1px solid var(--success);
            padding: 4px 16px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: 700; 
            letter-spacing: 1px;
        }

        /* Sidebar */
        aside {
            grid-row: 2 / -1;
            border-right: 1px solid var(--border);
            padding: 30px;
            background: rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }

        .metric { margin-bottom: 30px; }
        .metric label { 
            display: block; 
            color: var(--text-muted); 
            font-size: 0.7rem; 
            text-transform: uppercase; 
            letter-spacing: 1.5px;
            margin-bottom: 5px;
        }
        .metric value { 
            display: block; 
            font-size: 1.8rem; 
            font-weight: 300;
            color: var(--text-main); 
        }
        #score-display { color: var(--accent); font-weight: 600; }

        /* Main Workspace */
        main {
            padding: 50px;
            overflow-y: auto;
            position: relative;
            background: radial-gradient(circle at top right, rgba(242, 196, 61, 0.03), transparent 40%);
        }

        /* Interaction Container */
        .interaction-card {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        h2 { 
            margin-top: 0; 
            color: var(--accent); 
            font-weight: 600; 
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .scenario-text { 
            font-size: 1.1rem; 
            line-height: 1.7; 
            margin-bottom: 30px; 
            color: #d4d4d4;
        }

        /* Buttons & Inputs */
        button {
            background: var(--accent);
            color: var(--text-on-accent);
            border: none;
            padding: 14px 28px;
            border-radius: 50px; /* Pill shape buttons */
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 12px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(242, 196, 61, 0.3); }
        
        button.secondary { 
            background: transparent; 
            border: 1px solid var(--border); 
            color: var(--text-main); 
        }
        button.secondary:hover { border-color: var(--accent); color: var(--accent); box-shadow: none; }
        
        input[type="number"] {
            background: var(--panel-bg); 
            border: 1px solid var(--border);
            color: white; 
            padding: 12px; 
            font-size: 1.2rem; 
            width: 120px;
            border-radius: 8px;
            margin-right: 10px;
        }
        input[type="number"]:focus { outline: 2px solid var(--accent); border-color: transparent; }

        /* Feedback Modal (Overlay) */
        #feedback-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(18, 18, 18, 0.95);
            display: none; 
            justify-content: center;
            align-items: center;
            z-index: 10;
            backdrop-filter: blur(5px);
        }
        .feedback-box {
            background: var(--panel-bg);
            border: 1px solid var(--border);
            padding: 50px;
            border-radius: 16px;
            text-align: center;
            max-width: 550px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        .feedback-box h3 { font-size: 1.5rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .feedback-box p { font-size: 1.1rem; line-height: 1.6; color: var(--text-muted); margin-bottom: 30px; }

        /* Charts/Visuals */
        .data-viz {
            height: 160px; display: flex; align-items: flex-end; gap: 8px;
            margin: 30px 0; border-bottom: 1px solid var(--border); padding-bottom: 10px;
        }
        .bar { 
            background: var(--text-muted); 
            width: 40px; 
            border-radius: 4px 4px 0 0;
            transition: height 1s; 
            opacity: 0.5; 
        }
        .bar.highlight { background: var(--accent); opacity: 1; }
        .bar.danger { background: var(--danger); opacity: 1; }

        /* Footer */
        footer {
            border-top: 1px solid var(--border);
            padding: 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="maps-dashboard">
        <header>
            <div class="logo">MAPS <span>//</span> SYSTEM</div>
            <div id="step-indicator" style="font-size: 0.85rem; letter-spacing: 1px; color: var(--text-muted);">MODULE: INITIALIZATION</div>
            <div class="status-badge">SYSTEM OPTIMAL</div>
        </header>

        <aside>
            <div class="metric">
                <label>Operator ID</label>
                <value>TECH-884</value>
            </div>
            <div class="metric">
                <label>Efficiency Rating</label>
                <value id="score-display">100%</value>
            </div>
            <div class="metric">
                <label>Active Ticket</label>
                <value>#8839-AX</value>
            </div>
            
            <div style="flex-grow:1"></div>
            
            <div class="metric">
                <label>Activity Log</label>
                <div id="log-container" style="font-size: 0.7rem; color: var(--text-muted); height: 150px; overflow-y: auto; font-family: 'Courier New', monospace; line-height: 1.4; border-top: 1px solid var(--border); padding-top: 10px;">
                    > MAPS v1.0 Boot Sequence...<br>
                    > Connection Established...
                </div>
            </div>
        </aside>

        <main id="game-area">
            </main>

        <footer>
            <span>Internal Manufacturing Only</span>
            <span>MAPS v1.0.4 | Terminal 04</span>
        </footer>
    </div>

    <div id="feedback-overlay">
        <div class="feedback-box" id="feedback-box">
            <h3 id="feedback-title">Title</h3>
            <p id="feedback-msg">Message</p>
            <button onclick="nextStep()">PROCEED</button>
        </div>
    </div>

    <script>
        // --- SIMULATION STATE ---
        let currentStep = 0;
        let score = 100;
        let lotoSequence = []; 

        // --- DOM ELEMENTS ---
        const gameArea = document.getElementById('game-area');
        const scoreDisplay = document.getElementById('score-display');
        const stepDisplay = document.getElementById('step-indicator');
        const logContainer = document.getElementById('log-container');
        const overlay = document.getElementById('feedback-overlay');
        const feedbackBox = document.getElementById('feedback-box');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackMsg = document.getElementById('feedback-msg');

        // --- SCENARIO DATA ---
        const scenarios = [
            {
                // INTRO
                type: 'intro',
                title: 'Job Assignment: #8839-AX',
                text: "You have a new job in the MAPS queue: <strong>High-Pressure Actuator Repair</strong>.<br><br>The physical unit is secured on your workbench. The digital work order has been pulled from the cloud.<br>Click 'Start Job' to begin the intake process.",
                action: `<button onclick="nextStep()">START JOB</button>`
            },
            {
                // STEP 1: VERIFICATION
                type: 'choice',
                title: 'Step 1: Intake Verification',
                text: "<strong>DATA MISMATCH DETECTED:</strong><br>The Digital Work Order lists priority as 'Standard Maintenance'.<br>However, the physical tag on the unit has a red 'Safety Incident' sticker.<br><br>How do you proceed?",
                options: [
                    { label: "Proceed with Standard Maintenance", correct: false, msg: "Incorrect. Ignoring a physical safety tag creates legal liability and safety risks." },
                    { label: "Update Digital Record to 'Safety Incident'", correct: true, msg: "Correct. Data integrity is crucial. Updating the record unlocks the required Incident Investigation fields." },
                    { label: "Remove the red sticker", correct: false, msg: "Critical Error. Never remove safety tags without authorization." }
                ]
            },
            {
                // STEP 2: LOTO (Lockout/Tagout)
                type: 'loto',
                title: 'Step 2: Lockout / Tagout',
                text: "The unit is still connected to the test bench power and hydraulic lines.<br>Engage the safety protocols in the <strong>correct order</strong>.",
                render: () => {
                    lotoSequence = [];
                    return `
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                            <button id="loto-1" class="secondary" onclick="lotoClick(1, this)">Apply Padlock</button>
                            <button id="loto-2" class="secondary" onclick="lotoClick(2, this)">Disconnect Power</button>
                            <button id="loto-3" class="secondary" onclick="lotoClick(3, this)">Verify Zero Energy</button>
                            <button id="loto-4" class="secondary" onclick="lotoClick(4, this)">Discharge Hydraulics</button>
                        </div>
                        <div id="loto-status" style="font-family:'Courier New', monospace; color:var(--accent); font-size: 0.9rem;">WAITING FOR INPUT...</div>
                    `;
                }
            },
            {
                // STEP 3: DIAGNOSTICS
                type: 'choice',
                title: 'Step 3: Diagnostic Analysis',
                text: "You run the pressure retention test via MAPS. Analyze the data visualization below.<br><strong>What is the root cause of this variance?</strong>",
                render: () => `
                    <div class="data-viz">
                        <div class="bar" style="height: 20%"></div>
                        <div class="bar" style="height: 25%"></div>
                        <div class="bar" style="height: 35%"></div>
                        <div class="bar" style="height: 50%"></div>
                        <div class="bar highlight" style="height: 65%"></div>
                        <div class="bar highlight" style="height: 85%"></div>
                        <div class="bar danger" style="height: 95%"></div>
                    </div>
                `,
                options: [
                    { label: "Sensor Drift (Random)", correct: false, msg: "Incorrect. The data is not random; it shows a clear upward trend." },
                    { label: "Seal Failure (Upward Trend)", correct: true, msg: "Correct. Consistent pressure increases usually indicate internal seal failure." },
                    { label: "Software Glitch", correct: false, msg: "Incorrect. The data points are consistent, not erratic." }
                ]
            },
            {
                // STEP 4: PARTS
                type: 'choice',
                title: 'Step 4: Parts Requisition',
                text: "You need a 'Seal Kit Type-4'.<br><strong>Inventory Status:</strong><br>- OEM Kit: 0 Stock (2 day wait)<br>- Aftermarket Kit: 50 Stock<br><br>The job is marked 'RUSH', but the contract says 'OEM Parts Only'. What do you do?",
                options: [
                    { label: "Use Aftermarket Kit (Meet Deadline)", correct: false, msg: "Incorrect. Contract compliance overrides 'Rush' status. Warranty is now void." },
                    { label: "Flag 'Awaiting Parts' (Delay Job)", correct: true, msg: "Correct. You cannot violate the 'OEM Only' clause without written manager approval." }
                ]
            },
            {
                // STEP 5: CALIBRATION
                type: 'input',
                title: 'Step 5: Final Calibration',
                text: "The unit is reassembled. Refer to the manual for torque specs.<br><strong>Manual:</strong> Target 45 Nm (+/- 2 Nm).<br><br>Enter the measured torque value:",
                render: () => `<input type="number" id="torque-input" placeholder="00"> <button onclick="checkTorque()">SUBMIT LOG</button>`
            },
            {
                // STEP 6: QC
                type: 'choice',
                title: 'Step 6: Quality Control',
                text: "The Actuator repair is complete and passed tests.<br>However, during wipe-down, you notice a <strong>hairline crack on the mounting bracket</strong> (a part you did not touch).<br><br>Do you release the unit?",
                options: [
                    { label: "Yes, release it (My job is done)", correct: false, msg: "Safety Violation. You cannot release a unit with known structural damage." },
                    { label: "No, flag for Structural Review", correct: true, msg: "Correct. Good catch. This requires a secondary work order." }
                ]
            },
            {
                // END
                type: 'end',
                title: 'Simulation Complete',
                text: "Job #8839-AX has been processed and logged in MAPS.",
                render: () => `
                    <div style="font-size: 3rem; font-weight:300; margin-bottom: 20px; color: ${score > 80 ? 'var(--success)' : 'var(--danger)'}">${score}%</div>
                    <button onclick="location.reload()">PROCESS NEXT JOB</button>
                `
            }
        ];

        // --- CORE FUNCTIONS ---

        function init() {
            renderStep();
        }

        function renderStep() {
            const data = scenarios[currentStep];
            stepDisplay.innerText = `MODULE: ${data.title.toUpperCase()}`;
            
            let html = `<h2>${data.title}</h2><div class="scenario-text">${data.text}</div>`;

            // Custom Renders (LOTO, Input, Charts)
            if (data.render) {
                html += data.render();
            }

            // Button Choices
            if (data.options) {
                html += `<div style="margin-top:30px;">`;
                data.options.forEach((opt, index) => {
                    html += `<button class="secondary" onclick="checkChoice(${index})">${opt.label}</button>`;
                });
                html += `</div>`;
            }

            // Intro Action
            if (data.action) {
                html += data.action;
            }

            gameArea.innerHTML = `<div class="interaction-card">${html}</div>`;
        }

        function checkChoice(index) {
            const data = scenarios[currentStep];
            const choice = data.options[index];
            showFeedback(choice.correct, choice.msg);
        }

        function showFeedback(isCorrect, msg) {
            overlay.style.display = 'flex';
            feedbackTitle.innerText = isCorrect ? 'DECISION LOGGED: VERIFIED' : 'DECISION LOGGED: ERROR';
            feedbackTitle.style.color = isCorrect ? 'var(--success)' : 'var(--danger)';
            feedbackMsg.innerText = msg;

            if (!isCorrect) {
                updateScore(-15);
                addLog(`WARN: Step ${currentStep} - Deviation detected.`);
            } else {
                addLog(`OK: Step ${currentStep} - Protocol verified.`);
            }
        }

        function nextStep() {
            overlay.style.display = 'none';
            currentStep++;
            if (currentStep < scenarios.length) {
                renderStep();
            }
        }

        function updateScore(amount) {
            score += amount;
            if (score < 0) score = 0;
            scoreDisplay.innerText = score + "%";
            scoreDisplay.style.color = score < 70 ? 'var(--danger)' : 'var(--accent)';
        }

        function addLog(msg) {
            const entry = document.createElement('div');
            entry.innerText = `> ${msg}`;
            logContainer.prepend(entry);
        }

        // --- SPECIFIC INTERACTION LOGIC ---

        function lotoClick(id, btn) {
            btn.disabled = true;
            btn.style.borderColor = "var(--success)";
            btn.style.color = "var(--success)";
            lotoSequence.push(id);
            
            document.getElementById('loto-status').innerText = `SEQUENCE: ${lotoSequence.join(' > ')}`;

            if (lotoSequence.length === 4) {
                // Correct Order: 2 (Power), 4 (Hydraulics), 1 (Lock), 3 (Verify)
                const isCorrect = (JSON.stringify(lotoSequence) === JSON.stringify([2, 4, 1, 3]));
                if(isCorrect) {
                    showFeedback(true, "LOTO Applied correctly. Energy is zero state.");
                } else {
                    showFeedback(false, "Safety Violation! Sources must be disconnected BEFORE locking and verifying.");
                }
            }
        }

        function checkTorque() {
            const val = document.getElementById('torque-input').value;
            if (val >= 43 && val <= 47) {
                showFeedback(true, `Torque ${val} Nm is within tolerance (45 +/- 2).`);
            } else {
                showFeedback(false, `Torque ${val} Nm is OUT OF TOLERANCE. Re-calibrate.`);
            }
        }

        init();

    </script>
</body>
</html>